<!doctype html>
<meta charset=us-ascii>
<title>Geomantic Chart Generator</title>
<style>
td{vertical-align:top}
</style>

<h1>Geomantic Chart Generator</h1>

<table>
<tr>
<td><label for=type>Type:</label>
<td><select id=type>
<option value=shield>Shield</option>
<option value=house disabled>House</option>
</style>

<tr>
<td><label for=style>Style:</label>
<td><select id=style>
<option value=arabic>Arabic</option>
<option value=western>Western</option>
</style>

<tr>
<td><label for=m1>First Mother:</label>
<td><select id=m1>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m2>Second Mother:</label>
<td><select id=m2>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m3>Third Mother:</label>
<td><select id=m3>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m4>Fourth Mother:</label>
<td><select id=m4>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td>Preview
<td id=preview>

<tr>
<td>Dreamwidth Code<br>(Copy and Paste)
<td><textarea id=copypaste cols=80 rows=20 readOnly></textarea>
</table>

<script>
"use strict";
const PREFIX = "https://shedivesin.github.io/emoji/";
const SUFFIXES = [
  "/populus.svg",
  "/laetitia.svg",
  "/rubeus.svg",
  "/fortuna_minor.svg",
  "/albus.svg",
  "/amissio.svg",
  "/conjunctio.svg",
  "/cauda_draconis.svg",
  "/tristitia.svg",
  "/carcer.svg",
  "/acquisitio.svg",
  "/puer.svg",
  "/fortuna_major.svg",
  "/puella.svg",
  "/caput_draconis.svg",
  "/via.svg",
];

function reload() {
  // mothers
  const f = [
    document.getElementById("m1").selectedIndex,
    document.getElementById("m2").selectedIndex,
    document.getElementById("m3").selectedIndex,
    document.getElementById("m4").selectedIndex,
  ];

  // daughters
  f.push(
    (f[0] & 1) | ((f[1] & 1) << 1) | ((f[2] & 1) << 2) | ((f[3] & 1) << 3),
    ((f[0] & 2) >> 1) | (f[1] & 2) | ((f[2] & 2) << 1) | ((f[3] & 2) << 2),
    ((f[0] & 4) >> 2) | ((f[1] & 4) >> 1) | (f[2] & 4) | ((f[3] & 4) << 1),
    ((f[0] & 8) >> 3) | ((f[1] & 8) >> 2) | ((f[2] & 8) >> 1) | (f[3] & 8),
  );

  // nieces & court
  for(let i = 0; i < 14; f.push(f[i++] ^ f[i++]));

  // reconciler
  f.push(f[0] ^ f[14]);

  // redraw the svg
  const style = document.getElementById("style").value;
  let code = "<center><table><tr>";
  for(let i = 7; i >= 0; i--) {
    code += "<td><img style=\"display:block;margin:auto\" src=\"" + PREFIX + style + SUFFIXES[f[i]] + "\" width=\"60\" height=\"60\"/>";
  }

  code += "<tr>";
  for(let i = 11; i >= 8; i--) {
    code += "<td colspan=\"2\"><img style=\"display:block;margin:auto\" src=\"" + PREFIX + style + SUFFIXES[f[i]] + "\" width=\"60\" height=\"60\"/>";
  }

  code += "<tr>"
  for(let i = 13; i >= 12; i--) {
    code += "<td colspan=\"4\"><img style=\"display:block;margin:auto\" src=\"" + PREFIX + style + SUFFIXES[f[i]] + "\" width=\"60\" height=\"60\"/>";
  }

  code += "<tr>"
  for(let i = 14; i >= 14; i--) {
    code += "<td colspan=\"8\"><img style=\"display:block;margin:auto\" src=\"" + PREFIX + style + SUFFIXES[f[i]] + "\" width=\"60\" height=\"60\"/>";
  }

  code += "</table></center>";

  // rewrite the preview
  const preview = document.getElementById("preview");
  preview.innerHTML = code;

  // rewrite the copy-paste area
  const copypaste = document.getElementById("copypaste");
  copypaste.value = code;
  copypaste.select();
}

// trigger a reload whenever the form is changed
for(const el of document.getElementsByTagName("select")) {
  el.addEventListener("input", reload);
}

// reload immediately
reload();
</script>
