<!doctype html>
<meta charset=us-ascii>
<title>Geomancy Emoji</title>
<style>
td{vertical-align:top}
</style>

<h1>Geomantic Chart Generator</h1>

<table>
<tr>
<td><label for=type>Type:</label>
<td><select id=type>
<option value=shield>Shield</option>
<option value=house disabled>House</option>
</style>

<tr>
<td><label for=style>Style:</label>
<td><select id=style>
<option value=arabic>Arabic</option>
<option value=western>Western</option>
</style>

<tr>
<td><label for=m1>First Mother:</label>
<td><select id=m1>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m2>Second Mother:</label>
<td><select id=m2>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m3>Third Mother:</label>
<td><select id=m3>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td><label for=m4>Fourth Mother:</label>
<td><select id=m4>
<option>Populus</option>
<option>Laetitia</option>
<option>Rubeus</option>
<option>Fortuna Minor</option>
<option>Albus</option>
<option>Amissio</option>
<option>Conjunctio</option>
<option>Cauda Draconis</option>
<option>Tristitia</option>
<option>Carcer</option>
<option>Acquisitio</option>
<option>Puer</option>
<option>Fortuna Major</option>
<option>Puella</option>
<option>Caput Draconis</option>
<option>Via</option>
</select>

<tr>
<td>Preview
<td><svg viewBox="0 0 171 87" width="513" height="261"><g stroke="black"><path d="M1 1H170V86H1Z" fill="white" stroke-width="2"/><path d="M1 22.5H170M1 43.5H170M1 64.5H170M22.5 1V22.5M43.5 1V43.5M64.5 1V22.5M85.5 1V64.5M106.5 1V22.5M127.5 1V43.5M148.5 1V22.5" fill="none"/></g><image x="149" y="2" width="20" height="20"/><image x="128" y="2" width="20" height="20"/><image x="107" y="2" width="20" height="20"/><image x="86" y="2" width="20" height="20"/><image x="65" y="2" width="20" height="20"/><image x="44" y="2" width="20" height="20"/><image x="23" y="2" width="20" height="20"/><image x="2" y="2" width="20" height="20"/><image x="138.5" y="23" width="20" height="20"/><image x="96.5" y="23" width="20" height="20"/><image x="54.5" y="23" width="20" height="20"/><image x="12.5" y="23" width="20" height="20"/><image x="117.5" y="44" width="20" height="20"/><image x="33.5" y="44" width="20" height="20"/><image x="75.5" y="65" width="20" height="20"/><image x="149" y="65" width="20" height="20"/></svg>

<tr>
<td>Dreamwidth Code<br>(Copy and Paste)
<td><textarea cols=80 rows=20 readOnly></textarea>
</table>

<script>
"use strict";
const PREFIX = "https://shedivesin.github.io/emoji/";
const SUFFIXES = [
  "/populus.svg",
  "/laetitia.svg",
  "/rubeus.svg",
  "/fortuna_minor.svg",
  "/albus.svg",
  "/amissio.svg",
  "/conjunctio.svg",
  "/cauda_draconis.svg",
  "/tristitia.svg",
  "/carcer.svg",
  "/acquisitio.svg",
  "/puer.svg",
  "/fortuna_major.svg",
  "/puella.svg",
  "/caput_draconis.svg",
  "/via.svg",
];

function reload() {
  // mothers
  const f = [
    document.getElementById("m1").selectedIndex,
    document.getElementById("m2").selectedIndex,
    document.getElementById("m3").selectedIndex,
    document.getElementById("m4").selectedIndex,
  ];

  // daughters
  f.push(
    (f[0] & 1) | ((f[1] & 1) << 1) | ((f[2] & 1) << 2) | ((f[3] & 1) << 3),
    ((f[0] & 2) >> 1) | (f[1] & 2) | ((f[2] & 2) << 1) | ((f[3] & 2) << 2),
    ((f[0] & 4) >> 2) | ((f[1] & 4) >> 1) | (f[2] & 4) | ((f[3] & 4) << 1),
    ((f[0] & 8) >> 3) | ((f[1] & 8) >> 2) | ((f[2] & 8) >> 1) | (f[3] & 8),
  );

  // nieces & court
  for(let i = 0; i < 14; f.push(f[i++] ^ f[i++]));

  // reconciler
  f.push(f[0] ^ f[14]);

  // redraw the svg
  const images = document.getElementsByTagName("image");
  const style = document.getElementById("style").value;
  for(let i = 0; i < 16; i++) {
    images[i].setAttribute("href", PREFIX + style + SUFFIXES[f[i]]);
  }

  // rewrite the copy-paste
  const svg = document.getElementsByTagName("svg")[0];
  const textarea = document.getElementsByTagName("textarea")[0];
  textarea.value = "<center>" + svg.outerHTML + "</center>";

  // select the copy-paste so it's easy to, y'know, copy-paste
  textarea.select();
}

// trigger a reload whenever the form is changed
for(const el of document.getElementsByTagName("select")) {
  el.addEventListener("input", reload);
}

// reload immediately
reload();
</script>
