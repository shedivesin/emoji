<!doctype html>
<meta charset=us-ascii>
<title>Geomancy Emoji</title>
<style>
html,body{height:100%;margin:0;padding:0}
body{display:flex;justify-content:center;align-items:center}
table{background:repeating-linear-gradient(135deg,#ddd,#ddd 16px,#ccc 16px,#ccc 32px);border-collapse:collapse}
td{padding:8px}
tr:first-child>td{padding-top:32px}
td:last-child{padding-right:32px}
tr:last-child>td{padding-bottom:32px}
td:first-child{padding-left:32px}
canvas,img{display:block;width:64px;height:64px}
</style>
<table>
<tr>
<td><a href=populus.png><canvas width=256 height=256></canvas></a>
<td><a href=laetitia.png><canvas width=256 height=256></canvas></a>
<td><a href=rubeus.png><canvas width=256 height=256></canvas></a>
<td><a href=fortuna_minor.png><canvas width=256 height=256></canvas></a>

<tr>
<td><a href=albus.png><canvas width=256 height=256></canvas></a>
<td><a href=amissio.png><canvas width=256 height=256></canvas></a>
<td><a href=conjunctio.png><canvas width=256 height=256></canvas></a>
<td><a href=cauda_draconis.png><canvas width=256 height=256></canvas></a>

<tr>
<td><a href=tristitia.svg><img src=tristitia.svg></a>
<td><a href=carcer.svg><img src=carcer.svg></a>
<td><a href=acquisitio.svg><img src=acquisitio.svg></a>
<td><a href=puer.svg><img src=puer.svg></a>

<tr>
<td><a href=fortuna_major.svg><img src=fortuna_major.svg></a>
<td><a href=puella.svg><img src=puella.svg></a>
<td><a href=caput_draconis.svg><img src=caput_draconis.svg></a>
<td><a href=via.svg><img src=via.svg></a>
</table>
<script>
"use strict";


// Create a squircle
const id = new ImageData(256, 256);

for(let y = 0, i = 0; y < id.height; y++) {
  for(let x = 0; x < id.width; x++) {
    let c = 0;

    for(let v = 0; v < 16; v++) {
      let b = (2 * y + 0.125 * v + 0.0625) / id.height - 1;
      b *= b;
      b *= b;

      for(let u = 0; u < 16; u++) {
        let a = (2 * x + 0.125 * u + 0.0625) / id.width - 1;
        a *= a;
        a *= a;
        if(a + b > 1) {
          continue;
        }

        c++;
      }
    }

    id.data[i++] = 255;
    id.data[i++] = 255;
    id.data[i++] = 255;
    id.data[i++] = c;
  }
}


// Draw emojis onto the canvases
const canvases = document.getElementsByTagName("canvas");

for(let i = 0; i < canvases.length; i++) {
  const canvas = canvases[i];
  const ctx = canvas.getContext("2d");
  const a = id.width * 0.5;
  const b = id.height * 0.05;

  // Splat the squircle onto the canvas
  ctx.putImageData(id, 0, 0);

  // Draw the geomantic figure corresponding to this binary number
  for(let j = 0; j < 4; j++) {
    if((i >> j) & 1) {
      ctx.fillStyle = "crimson";
      ctx.beginPath();
      ctx.moveTo(a        , (4 * j + 2) * b);
      ctx.lineTo(a + 2 * b, (4 * j + 4) * b);
      ctx.lineTo(a        , (4 * j + 6) * b);
      ctx.lineTo(a - 2 * b, (4 * j + 4) * b);
      ctx.fill();
    }
    else {
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.moveTo(a - 5 * b, (4 * j + 3) * b);
      ctx.lineTo(a + 6 * b, (4 * j + 3) * b);
      ctx.lineTo(a + 5 * b, (4 * j + 5) * b);
      ctx.lineTo(a - 6 * b, (4 * j + 5) * b);
      ctx.fill();
    }
  }
}
</script>
